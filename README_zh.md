# 基于Q-learning的回合制策略游戏强化学习项目

## 项目背景
本项目模拟了类似《红色警戒3》中10个防空步兵对战天启坦克的回合制策略场景。玩家通过强化学习算法控制步兵单位，目标是在坦克的碾压和攻击下存活并摧毁坦克。项目采用Q-learning算法进行训练，包含完整的游戏逻辑、可视化界面和训练框架。

视频链接：https://drive.google.com/file/d/1eMiAzq4YBNE3Hugr_GHDW3v9E791aPqy/view?usp=sharing

---

## 代码结构说明

### 核心模块
| 文件            | 功能描述                                                     |
| --------------- | ------------------------------------------------------------ |
| **game5.py**    | 主游戏入口，包含带UI(`start_ui()`)和无UI(`start_no_ui()`)两种模式，处理玩家输入、回合流程和胜负判定 |
| **tank.py**     | 定义`Tank`类（血量75/攻击2/移动7）和`TankAI`类，实现坦克移动、碾压、范围攻击及AI决策逻辑 |
| **infantry.py** | 定义`Infantry`类（血量8/攻击1/移动4），包含步兵属性和预生成动作空间`ACTION`（共41种移动组合） |
| **panal.py**    | 游戏界面模块，处理网格绘制、血条面板、胜负提示，定义战场参数（100x100网格，CELL=12px） |

### 训练系统
| 文件            | 功能描述                                                     |
| --------------- | ------------------------------------------------------------ |
| **train.py**    | 无界面训练脚本，包含`Environment`类（环境交互）和`QLearningAgent`类（Q表管理/策略学习） |
| **train_ui.py** | 带可视化界面的训练脚本，支持训练过程动态展示，继承并扩展了基础训练逻辑 |

---

## 核心机制（代码实现版）

### 单位参数
| 单位     | 属性                | 代码值           |
| -------- | ------------------- | ---------------- |
| 防空步兵 | 血量/移动/射程      | 8 / 4 / 18       |
| 天启坦克 | 血量/攻击/移动/体积 | 75 / 2 / 7 / 3x3 |

### 回合流程
1. **玩家阶段**：步兵执行Q-learning策略选择的移动动作
2. **坦克阶段**：
   - AI决策移动路径（优先接近最近存活步兵）
   - 碾压路径上的步兵立即死亡
   - 自动攻击射程内目标（范围攻击未实现）
3. **环境结算**：检查坦克血量归零或步兵全灭的胜负条件

### 关键逻辑
- **坦克碾压**：通过`Tank.crush()`方法实现3x3区域秒杀
- **奖励机制**：
  - 成功攻击坦克：+6奖励
  - 被碾压：-35惩罚
  - 无效移动：-1惩罚
- **状态编码**：`(dx, dy, hp)`表示步兵与坦克的相对位置和当前血量

---

## 运行说明

### 依赖环境
```bash
pip install pygame
```

### 启动方式

- **直接游戏**：运行`game5.py`体验基础玩法
- **无界面训练**：执行`train.py`（需解除末尾pickle保存代码）
- **可视化训练**：运行`train_ui.py`观察学习过程

### 文件关系图

game5.py（主入口）
  ├── tank.py        # 坦克逻辑
  ├── infantry.py    # 步兵属性
  ├── panal.py       # 界面绘制
  ├── train.py       # 核心训练逻辑
  └── train_ui.py    # 可视化训练扩展
